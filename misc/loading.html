<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Loading</title>

    <script src="/components/progress_bar/progress_bar.js"></script>

    <style>
        body {
            margin: 0;
            box-sizing: border-box;
            width: 100vw;
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
    </style>
</head>
<body>
    <progress-bar
        id="progress"
        data-calibration='{
        }'
        width="400"
        height="20"
        containerColor="rgb(168, 168, 168)"
        barColor="#1880ff"
    >
    </progress-bar>
    <p>Loading <span id="dot3"></span></p>

    <script>
        const progress_bar = document.querySelector('#progress');

        function setCheckpoints() {
            const transition = (() => {
                const options = ['ease', 'linear', 'steps(10, start)', 'steps(10, end)'];
                const index = Math.floor(Math.random() * options.length);

                return options[index];
            })();

            const percent = Math.floor(Math.random() * 100);
            const ms = Math.random() * 8000 + 2000; // 2 - 10 sec
            let checkpoints = JSON.parse(progress_bar.getAttribute('data-calibration'))?.checkpoints || [];
            checkpoints.push([percent, ms, transition]);

            const data_calibration = {checkpoints: checkpoints};
            progress_bar.setAttribute('data-calibration', JSON.stringify(data_calibration));

            setTimeout(setCheckpoints, ms);
        }

        setCheckpoints();

        setInterval(() => {
            const dot3 = document.querySelector('#dot3');

            let text = dot3.innerText;
            if (text.length === 3) {
                text = '';
            } else {
                text += '.';
            }

            dot3.innerText = text;
        }, 500);

        
    </script>
</body>
</html>